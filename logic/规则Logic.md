# 规则Logic

## 说明
- 版本V1.003
- 该规则直接服务于Sever,并非选手版本
- *斜体表示Logic底层尚未（完全）实现*
- []表示待决定

## 游戏简介
- 1位监管者对抗4位求生者的非对称竞技模式
- 略

## 地图
- 地图为矩形区域，地图上的游戏对象坐标为（x, y），且x和y均为整数。x坐标轴正方向竖直向下，
- y坐标轴正方向水平向右；极坐标以x坐标轴为极轴，角度逆时针为正方向。
- 地图由50 * 50个格子构成，其中每个格子代表1000 * 1000的正方形。每个格子的编号(CellX,CellY)可以计算得到：
  - 略
  - 也就是说，地图实际大小是 50000 * 50000
- 地图上的每个格子有自己的区域类型：墙、草地、电机、出口、紧急出口、门、窗、箱子
- 出生点固定且一定为空地

## 游戏内的枚举类型、类与属性
- 底层实现中的属性，不代表界面全部都需要展示，也可能需要额外展示信息
- 只展示外部需要的属性，部分属性被省略

### Bgm
- *double bgmVolume*
- *BgmType bgmType*
  对于枚举类BgmType
  1. *不详的感觉：监管者进入（求生者的警戒半径/监管者的隐蔽度）时，求生者收到；监管者距离求生者越近，Bgm音量越大。bgmVolume=（警戒半径/二者距离）*
  2. *期待搞事的感觉：求生者进入（监管者的警戒半径/求生者的隐蔽度）时，监管者收到；监管者距离求生者越近，Bgm音量2.越大。bgmVolume=（警戒半径/二者距离）*
  3. *修理电机的声音: 警戒半径内有电机正在被修理时，全员收到；bgmVolume=（警戒半径/二者距离）*电机修理程度/10300000*
  ~~~csharp
    public enum BgmType
    {
        Null = 0,
        GhostIsComing = 1,
        StudentIsApproaching = 2,
        GeneratorIsBeingFixed = 3,
    }
  ~~~

### 技能
  ~~~csharp
    public enum ActiveSkillType  // 主动技能
    {
        Null = 0,
        BecomeInvisible = 1,
        ...
        UseKnife = 5,
        BeginToCharge = 6
    }
    public enum PassiveSkillType
    {
        Null = 0,
    }
  ~~~

### 物体
- 位置
- ID
- 类型
- 面向角度
- 形状
- 半径
- 是否可移动
- 是否在移动
- 移动速度

### 人物：物体

- 装弹CD
- 持有子弹数量
- 血量
- 最大血量
- 玩家状态（不可叠加）
  ~~~csharp
    public enum PlayerStateType
    {
        Null = 0,
        IsAddicted = 1,
        IsEscaped = 2,
        IsSwinging = 3,//指后摇
        IsDeceased = 4,
        IsMoving = 5,
        IsTreating = 6,
        IsRescuing = 7,
        IsFixing = 8,
        IsTreated = 9,
        IsRescued = 10,
        IsStunned = 11,
        IsTryingToAttack = 12,//指前摇
        IsLockingTheDoor = 13,
        IsRummagingInTheDrawer = 14,
        IsClimbingThroughWindows = 15,
    }
  ~~~
- *Bgm(数组)*
- 得分
- ~~回血率/原始回血率~~
- 当前子弹类型
- 原始子弹类型
- 持有道具*（最多三个）(数组)*
- 是否隐身
- 队伍ID
- 玩家ID
- 当前Buff
- 职业类型
- 拥有的被动技能(数组)
- 拥有的主动技能(数组)
- 各个主动技能CD(数组)
- *警戒半径*
- *double 隐蔽度*
- *翻墙速度*
- *开锁门速度*

### 学生：人物
- 修理电机速度
- 治疗速度
- 救人速度
- ~~自愈次数~~
- 沉迷游戏程度
- 最大沉迷游戏程度
- 被治疗程度

### 搞蛋鬼：人物
无

### 队伍：
- 队伍ID
- 队伍得分
- 队伍成员

### 所有物：
- 主人

### 子弹：所有物
- 子弹攻击范围
- 子弹爆炸范围
- 子弹攻击力
- 是否可以穿墙
- 是否可以爆炸
- 移动速度
- 子弹类型

### 爆炸中的子弹：物体
- 原来的子弹ID
- 爆炸范围
- 子弹类型

### 道具：所有物
- 是否放置地图上
- 道具类型

### 被捡起的道具：物体
- 原来的道具ID
- 道具类型

### 出口：物体
- *电力供应（是否可以被打开）*
- *是否打开*

### 紧急出口：物体
- *是否显现*
- *是否打开*

### 墙：物体

### 窗：物体
- *正在翻窗的人*
- *窗的朝向*

### 箱子：物体
- *里面的道具*

### 门：物体
- *属于那个教学区*
- *是否锁上*
- 不提供是否可以锁上的属性

### 电机（建议称为homework）：物体
- 修理程度

## 行为逻辑

### 初始状态
- 所有玩家可以立刻使用主动技能
- 玩家出生点固定

### 交互
- *除了逃离，交互目标与交互者在一个九宫格内则为可交互*

### 破译与逃脱
- *每张地图都会刷新 9台电机，求生者需要破译其中的7台*，并开启任意一个大门后从任意一个开启的大门- 逃脱，亦或者在只剩1名求生者的情况下从紧急出口逃脱；
- 求生者和监管者在靠近电机时，可以看到电机的破译进度条。
- 紧急出口会在电机破译完成3台的情况下在地图的3-5个固定紧急出口刷新点之一随机刷新。
- 当求生者只剩1名时，紧急出口盖将会自动打开，该求生者可从紧急出口逃脱。
- *一般情况下，开启大门所需时间为18秒。*

### 攻击
- 每次求生者收到攻击后会损失对应子弹的攻击力的血量
- 小部分求生者通过手持物可以获得一定程度反击监管者的手段，可使其丧失行动能力（称为击晕），但监管者不会永久丧失行动能力。
- 无论搞蛋鬼或学生，攻击时，从播放攻击动作到可以开始产生伤害的期间，称为前摇。（前摇阶段，搞蛋鬼产生通常为不可爆炸（部分搞蛋鬼能可以产生可爆炸）子弹（爆炸范围=0），[子弹大小待商榷]，期间监管者攻击被打断时，子弹消失）（无论近战远程均产生子弹）
- 无论搞蛋鬼或学生，攻击后，通常会出现一段无伤害判定的攻击动作后置时间，称为后摇。击中物体时后摇更长

- *假如监管者攻击或一些监管者的特定技能击中正在交互的求生者，将使求生者眩晕*
1. 处于前摇或后摇
2. 治疗或解救他人
3. 修理电机
4. 开锁门
5. 翻窗
6. 翻找箱子

### 门
- *门分别属于三个教学区：三教，五教，六教*
- *监管者或求生者都需要拿到对应教学区的钥匙才能打开或锁住对应的门*
- *锁门和开门都需要一定时间，进出门为正常移动过程*
- *门只有开、锁两种状态，锁住时门有碰撞体积*
- *当门所在格子内有人时，无法锁门*
- *钥匙只会出现在箱子中，每个教学区都有2把钥匙*

### 窗
- *求生者和监管者都可以翻越窗户，但通常情况下监管者翻越窗户的速度**高于**求生者。*
- *在求生者或监管者正在翻越窗户时，其他玩家均不可以翻越该窗户。*
- *窗始终有碰撞体积*
- *翻越窗户是一种交互行为，执行时，实质是限定方向的减速运动*

### 箱子
- *监管者和求生者都能与箱子交互。*
- *开启箱子有不同概率获得不同道具。*
- *搜寻物品的基础持续时间为10秒。*
- *未搜寻完成的箱子在下一次需要重新开始搜寻。*

### 治疗
- 可行动的求生者可以对受伤的其他求生者进行治疗，治疗完成后会回复被治疗程度的血量。
- 治疗时每毫秒增加相当于治疗者治疗速度的被治疗程度
- 当达到被治疗程度达到1500000或者最大血量与当前血量的差值时，治疗结束。

- 治疗中断时，被治疗程度保留；被治疗者遭到攻击时被治疗程度清空

### 沉迷
- 当求生者血量归零时，求生者自动原地进入沉迷状态，每毫秒增加1沉迷度
- 该求生者可由其他的求生者救下，救下后，*血量恢复至1/2并可以重新行动*。沉迷程度不清空。
- 进入沉迷状态时，如果求生者原本沉迷程度在【10003，30000】中，求生者沉迷程度直接变为30000
- 当求生者沉迷程度达到该玩家最大沉迷程度（学生有的属性）时，从游戏中出局

### 救人
- 一般情况下，救人时间为1秒。
